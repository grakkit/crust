import*as block from"./library/block.min.js";import*as entity from"./library/entity.min.js";import*as item from"./library/item.min.js";import*as location from"./library/location.min.js";import*as vector from"./library/vector.min.js";import*as tools from"./library/tools.min.js";const Block=Java.type("org.bukkit.block.Block"),Vector=Java.type("org.bukkit.util.Vector"),Entity=Java.type("org.bukkit.entity.Entity"),Location=Java.type("org.bukkit.Location"),ItemStack=Java.type("org.bukkit.inventory.ItemStack"),_=core.import("grakkit/framework"),$=(object,...args)=>{if([null,void 0].includes(object))return object;switch(typeof object){case"string":const prefix=object[0],suffix=object.slice(1);switch(prefix){case"~":if($[suffix])return $[suffix];{$[suffix]=_.object(_.array(Java.type(suffix).values()),value=>{if(!args[0]||!args[0](value)){let name="";return name=args[1]?args[1](value):"function"==typeof value.getKey?value.getKey().getKey():_.lower(value.name()),{[name]:value,[value]:name}}});const words=[];let index=-1;suffix.split(".").forEach(node=>{node.split("").map(char=>{char===_.upper(char)?words[++index]=char:words[index]&&(words[index]+=char)}),++index});const terms=_.flat(words);let key="";return key=terms.length<3?_.camel(terms.join(" ")," "):3===terms.length?_.lower(terms[0][0]+terms[1][0])+terms[2]:_.lower(terms.slice(0,-2).map(term=>term[0]).join(""))+terms.slice(-2).join(""),$[key]=$[suffix]}case"!":const item=ItemStack($.material[suffix]);return one("item",item.ensureServerConversions());case"@":const context=args[0]||server.getConsoleSender();return all("entity",..._.array(server.selectEntities(context,object)));case"#":return core.data(suffix,args[0]);case"?":const location=args[0]||self&&self.getLocation();return one("entity",location.getWorld().spawnEntity(location,$.entityType[suffix]));case"*":return event.on(suffix);case"/":return command.on(suffix);case"+":return all(suffix,...args);case"-":switch(toString.apply(args[0])){case"[object Object]":switch(toString.apply(args[0].instance)){case"[object Function]":return args[0].instance();case"[foreign HostObject]":return args[0].instance;default:return args[0]}case"[foreign HostObject]":return args[0];default:return null}default:return _.player(object)}case"object":if(object instanceof Block)return one("block",object);if(object instanceof Entity)return one("entity",object);if(object instanceof ItemStack)return one("item",object);if(object instanceof Location)return one("location",object);if(object instanceof Vector)return one("vector",object);if(object.constructor===Array){const thing=$("-",object[0]);return[null,void 0].includes(thing)?thing:thing.constructor===Object?jx[thing.format].parser(thing):"[foreign HostObject]"===toString.apply(thing)?$(thing).serialize():null}return null}};$("~org.bukkit.GameMode"),$("~org.bukkit.boss.BarFlag"),$("~org.bukkit.boss.BarColor"),$("~org.bukkit.boss.BarStyle"),$("~org.bukkit.block.BlockFace"),$("~org.bukkit.inventory.ItemFlag"),$("~org.bukkit.inventory.EquipmentSlot"),$("~org.bukkit.enchantments.Enchantment"),$("~org.bukkit.attribute.AttributeModifier.Operation"),$("~org.bukkit.Material",value=>value.isLegacy()),$("~org.bukkit.entity.EntityType",value=>"UNKNOWN"===value.name()),$("~org.bukkit.attribute.Attribute",null,value=>value.getKey().getKey().split(".")[1]),$("~org.bukkit.potion.PotionEffectType",null,value=>value.getHandle().c().split(".")[2]);const builder=tools.builder(_,$),command=tools.command(_,$),event=tools.event(_,$),jx={block:builder(block),entity:builder(entity),item:builder(item),location:builder(location),vector:builder(vector)},one=(type,instance)=>{const that=jx[type].chainer(jx[type].wrapper(instance)),output=_.object(jx[type].links,link=>({[link]:(...args)=>{const result=that[link](...args);return that===result?output:result[0]}}));return output},all=(type,...instances)=>{const that=jx[type].chainer(...instances.map(instance=>jx[type].wrapper(instance)));return _.extend(that,...Object.getOwnPropertyNames(Array.prototype).map(key=>{const value=Array.prototype[key];if("function"==typeof value)return{[key]:(...args)=>value.apply(instances,args)}}))};core.export($);